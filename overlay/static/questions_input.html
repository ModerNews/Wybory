<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Dodawanie pytań</title>

        <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>

        <style>
            button {
            font-size: 1.2em;
            }
        </style>
    </head>
    <body>
        <div id='question-container'>
            <!-- Questions will be added here -->
        </div>
        <div id='input-container'>
            <p><input id='question' type="text"><button class='send-question'>Wyślij</button></p>
        </div>
    </body>
    <script>
        let questions = document.getElementById("question-container")
        let ws

        function createWebsocket() {
            ws = new WebSocket("ws://" + location.hostname + ":" + location.port + "/websocket");
            ws.onopen = function(evt) { onOpen(evt) };
            ws.onclose = function(evt) { onClose(evt) };
            ws.onmessage = function(evt) { onMessage(evt) };
            ws.onerror = function(evt) { onError(evt) };
            
            function onOpen(evt)
            {

            }

            function onClose(evt)
            {
            console.log("Trying to reconnect...");
            setTimeout(createWebsocket, 1000);
            }

            function onMessage(evt)
            {

            }

            function onError(evt)
            {
                console.error("socket error");
            }
        }
        
        createWebsocket()

        $('.send-question').click((e) => {
            console.log("dispatching");

            var line = document.createElement("p")
            line.innerHTML = $('#question').val()
            questions.appendChild(line)

            ws.send(JSON.stringify({
            event: 'question-add',
            content: $('#question').val(),
            }));
        });
    </script>
</html>